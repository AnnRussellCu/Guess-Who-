<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>You Won!</title>

<link href="https://fonts.googleapis.com/css2?family=Dokdo&family=Bungee+Inline&display=swap" rel="stylesheet"/>

<style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
        background:#1E1E2F;
        font-family:'Dokdo', sans-serif;
        color:white;
        height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        overflow:hidden;
    }

    .win-screen {
        width:1500px;
        height:850px;
        background:rgba(255,255,255,0.05);
        border-radius:25px;
        border:3px dashed #9ca3af;
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:60px;
        position:relative;
    }

    .left-area {
        flex:1;
        text-align:center;
    }

    .you-won {
        font-family:'Bungee Inline', cursive;
        font-size:90px;
        color:#ffea00;
        text-shadow:0 0 20px #ffea00;
        margin-bottom:10px;
    }

    .player-1 {
        font-size:40px;
        opacity:0.9;
        margin-bottom:25px;
    }

    .medal-img {
        width:260px;
        margin-top:30px;
    }

    .side-buttons {
        width:320px;
        display:flex;
        flex-direction:column;
        gap:35px;
    }

    .btn {
        width:100%;
        height:70px;
        background:#a78bfa;
        border:none;
        border-radius:14px;
        font-family:'Bungee Inline', cursive;
        font-size:32px;
        color:white;
        cursor:pointer;
    }

    .btn-leave {
        background:#de7d4a;
    }

    .btn:hover {
        transform:scale(1.05);
        transition:0.2s;
    }

    .chat-box {
        width:420px;
        height:180px;
        background:#374151;
        border-radius:12px;
        padding:18px;
        position:absolute;
        right:40px;
        bottom:40px;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
    }

    .chat-inner {
        background:#d9d9d9;
        height:60px;
        padding:14px;
        border-radius:10px;
        color:#4b5563;
        font-size:22px;
        position:relative;
    }

  .sent-icon {
    width:15px;
    position:absolute;
    right:10px;
    top:20px; /* moves it down slightly so it's centered */
    transform:rotate(-45deg);
    cursor:pointer;
}

</style>

</head>
<body>

<div class="win-screen">

    <!-- LEFT -->
    <div class="left-area">
        <div class="you-won" id="resultText">YOU WON!</div>
        <div class="player-1">{{ username }}</div>

        <img src="{{ url_for('static', filename='img/golden-medal-first-place-medal-of-sport-competition-cartoon-design-for-poster-icon-card-logo-label-banner-or-sticker-graphic-design-isolated-illustration-vector-removebg-preview-10.png') }}"
             class="medal-img">
    </div>

    <!-- BUTTONS -->
    <div class="side-buttons">
        <button class="btn" id="playAgainBtn" onclick="playAgain()">PLAY AGAIN 0/2</button>
        <button class="btn btn-leave" onclick="leaveLobby()">LEAVE LOBBY</button>
    </div>

    <!-- CHAT -->
    <div class="chat-box">
    <div id="chatMessages" style="
        background:#1f2937;
        height:90px;
        overflow-y:auto;
        border-radius:10px;
        padding:10px;
        font-size:20px;
    "></div>

    <div class="chat-inner">
        <input id="chatInput" 
               placeholder="Enter message..." 
               style="width:85%; border:none; outline:none; background:none; font-size:22px; color:#4b5563;">
        <img src="sent0.png" class="sent-icon" onclick="sendMessage()">
    </div>
</div>

</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>

<script>
const socket = io();
const playBtn = document.getElementById("playAgainBtn");
const roomCode = "{{ room_code }}";
const username = "{{ username }}";

// Elements
const statusText = document.querySelector(".you-won");
const playerNameText = document.querySelector(".player-1");
const medalImg = document.querySelector(".medal-img");

// Default medal images
const winMedal = "{{ url_for('static', filename='img/goldmedal.png') }}";
const loseMedal = "{{ url_for('static', filename='img/silvermedal.png') }}";

// Join game room
socket.emit('join_game_room', { room_code: roomCode, username });

// Listen for game_over event
socket.on("game_over", (data) => {
    if (data.username !== username) return; // Only update for this player

    if (data.result === "win") {
        statusText.textContent = "YOU WON!";
        statusText.style.color = "#ffea00";
        statusText.style.textShadow = "0 0 20px #ffea00";
        medalImg.src = winMedal;
    } else {
    statusText.textContent = "YOU LOST!";
    statusText.style.color = "#3b82f6";        // blue
    statusText.style.textShadow = "0 0 20px #3b82f6";
    medalImg.src = loseMedal;
   }
    playerNameText.textContent = username;
});

// Ready / Play again button logic
let totalPlayers = 2;
let playersReady = 0;
let hasClicked = false;

socket.on('update_ready_count', (data) => {
    playersReady = data.ready_players;
    playBtn.innerText = `PLAY AGAIN ${playersReady}/${totalPlayers}`;
    if (playersReady < totalPlayers) {
        playBtn.innerText = `PLAY AGAIN ${playersReady}/${totalPlayers} (waiting...)`;
    }
});

function playAgain() {
    if (hasClicked) return;
    hasClicked = true;
    socket.emit('player_ready', { room_code: roomCode, username });
    playBtn.style.opacity = "0.7";
}

socket.on('start_game', () => {
    playBtn.innerText = "STARTING...";
    setTimeout(() => {
        window.location.href = `/play.html?room=${roomCode}&username=${username}`;
    }, 500);
});

function leaveLobby() {
    window.location.href = "/";
}

// CHAT SYSTEM
const chatMessages = document.getElementById("chatMessages");
const chatInput = document.getElementById("chatInput");

function sendMessage() {
    const msg = chatInput.value.trim();
    if (!msg) return;

    socket.emit("send_chat", {
        room: roomCode,
        username: username,
        message: msg
    });
    chatInput.value = "";
}

socket.on("receive_chat", (data) => {
    const { username: user, message } = data;
    const msgDiv = document.createElement("div");
    msgDiv.style.marginBottom = "6px";
    msgDiv.innerHTML = `<b>${user}:</b> ${message}`;
    chatMessages.appendChild(msgDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
});
</script>

</body>
</html>



