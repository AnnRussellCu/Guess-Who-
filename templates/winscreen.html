<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>You Won!</title>

<!-- Same fonts as play.html -->
<link href="https://fonts.googleapis.com/css2?family=Dokdo&family=Bungee+Inline&display=swap" rel="stylesheet"/>

<style>
    * { margin:0; padding:0; box-sizing:border-box; }

    body {
        background:#1E1E2F;
        font-family:'Dokdo', sans-serif;
        color:white;
        height:100vh;
        display:flex;
        justify-content:center;
        align-items:center;
        overflow:hidden;
    }

    .win-screen {
        width:1500px;
        height:850px;
        background:rgba(255,255,255,0.05);
        border-radius:25px;
        border:3px dashed #9ca3af;
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:60px;
        position:relative;
    }

    .left-area {
        flex:1;
        text-align:center;
    }

    .you-won {
        font-family:'Bungee Inline', cursive;
        font-size:90px;
        color:#a78bfa;
        text-shadow:0 0 20px #a78bfa;
        margin-bottom:10px;
    }

    .player-1 {
        font-size:40px;
        opacity:0.9;
        margin-bottom:25px;
    }

    .medal-img {
        width:260px;
        margin-top:30px;
    }

    .side-buttons {
        width:320px;
        display:flex;
        flex-direction:column;
        gap:35px;
    }

    .btn {
        width:100%;
        height:70px;
        background:#a78bfa;
        border:none;
        border-radius:14px;
        font-family:'Bungee Inline', cursive;
        font-size:32px;
        color:white;
        cursor:pointer;
    }

    .btn-leave {
        background:#de7d4a;
    }

    .btn:hover {
        transform:scale(1.05);
        transition:0.2s;
    }

    /* CHAT BOX (same style as play.html) */
    .chat-box {
        width:420px;
        height:180px;
        background:#374151;
        border-radius:12px;
        padding:18px;
        position:absolute;
        right:40px;
        bottom:40px;
        display:flex;
        flex-direction:column;
        justify-content:space-between;
    }

    .chat-inner {
        background:#d9d9d9;
        height:60px;
        padding:14px;
        border-radius:10px;
        color:#4b5563;
        font-size:22px;
        position:relative;
    }

    .sent-icon {
        width:36px;
        position:absolute;
        right:10px;
        top:12px;
        transform:rotate(-45deg);
        cursor:pointer;
    }
</style>

</head>
<body>

<div class="win-screen">

    <!-- LEFT -->
    <div class="left-area">
        <div class="you-won">YOU WON!</div>
        <div class="player-1">{{ username }}</div>

        <img src="{{ url_for('static', filename='img/golden-medal-first-place-medal-of-sport-competition-cartoon-design-for-poster-icon-card-logo-label-banner-or-sticker-graphic-design-isolated-illustration-vector-removebg-preview-10.png') }}"
             class="medal-img">
    </div>

    <!-- BUTTONS -->
    <div class="side-buttons">
        <button class="btn" id="playAgainBtn" onclick="playAgain()">PLAY AGAIN 0/2</button>
        <button class="btn btn-leave" onclick="leaveLobby()">LEAVE LOBBY</button>
    </div>

    <!-- CHAT -->
    <div class="chat-box">
        <div class="chat-inner">
            Enter message...
            <img src="sent0.png" class="sent-icon" onclick="sendMessage()">
        </div>
    </div>

</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();
const playBtn = document.getElementById("playAgainBtn");
const roomCode = "{{ room_code }}";
const username = "{{ username }}";

let totalPlayers = 2;
let playersReady = 0;
let hasClicked = false;

socket.emit('join_game_room', { room_code: roomCode, username });

socket.on('update_ready_count', (data) => {
    playersReady = data.ready_players;
    playBtn.innerText = `PLAY AGAIN ${playersReady}/${totalPlayers}`;

    if (playersReady < totalPlayers) {
      playBtn.innerText = `PLAY AGAIN ${playersReady}/${totalPlayers} (waiting...)`;
    }
});

function playAgain() {
    if (hasClicked) return;
    hasClicked = true;

    socket.emit('player_ready', { room_code: roomCode, username });
    playBtn.style.opacity = "0.7";
}

socket.on('start_game', () => {
    playBtn.innerText = "STARTING...";
    setTimeout(() => {
        window.location.href = `/play.html?room=${roomCode}&username=${username}`;
    }, 500);
});

function leaveLobby() {
    window.location.href = "/";
}

function sendMessage() {
    alert("Message sent!");
}
</script>

</body>
</html>
